<!DOCTYPE html>
<html lang="fa" dir="rtl" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OMID - ورود / ثبت‌نام</title>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500&family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet"/>

  <link rel="stylesheet" href="styles.css"/>
</head>
<body class="auth-page">
  <!-- پس‌زمینه هدر (در این صفحه مخفی می‌شود) -->
  <div id="header-background" class="header-background"></div>

  <!-- هدر مینیمال صفحه احراز هویت -->
  <header id="main-header" class="main-header active auth-header">
    <div class="header-container">
      <a class="back-link" href="index.html" aria-label="بازگشت به صفحه اصلی">
        <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        بازگشت
      </a>

      <h1 class="logo">OMID</h1>

      <button id="theme-toggle" class="theme-toggle" aria-label="تغییر تم">
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <img class="icon-moon" src="images/moon-icon.png" alt="Dark Mode Icon"/>
      </button>
    </div>
  </header>

  <div id="page-content" class="page-content">
    <main>
      <div class="auth-container">
        <div class="auth-card">
          <!-- تب‌ها -->
          <div class="auth-tabs" role="tablist">
            <button class="auth-tab active" data-target="#login" role="tab" aria-selected="true">ورود</button>
            <button class="auth-tab" data-target="#signup" role="tab" aria-selected="false">ثبت نام</button>
          </div>

          <div class="auth-panels">
            <!-- فرم ورود -->
            <form id="login" class="auth-form active" novalidate>
              <div class="input-group">
                <label for="login-email">ایمیل</label>
                <input id="login-email" type="email" name="email" placeholder="you@example.com" required/>
                <span class="field-error" aria-live="polite"></span>
              </div>

              <div class="input-group password-group">
                <label for="login-password">رمز عبور</label>
                <input id="login-password" type="password" name="password" placeholder="••••••••" required/>
                <button type="button" class="toggle-password" aria-label="نمایش/مخفی کردن رمز">👁</button>
                <span class="field-error" aria-live="polite"></span>
              </div>

              <div class="form-row">
                <label class="checkbox">
                  <input type="checkbox" name="remember"/>
                  مرا به خاطر بسپار
                </label>
                <a href="#" class="link" id="forgot-link">فراموشی رمز؟</a>
              </div>

              <button type="submit" class="btn primary">ورود</button>

              <div class="or-separator"><span>یا</span></div>

              <div class="social-row">
                <button type="button" class="btn outline w-100">ورود با گوگل</button>
              </div>

              <div class="form-message" aria-live="polite"></div>
            </form>

            <!-- فرم ثبت نام -->
            <form id="signup" class="auth-form" novalidate>
              <div class="input-group">
                <label for="signup-name">نام و نام خانوادگی</label>
                <input id="signup-name" type="text" name="name" placeholder="نام کامل" required/>
                <span class="field-error" aria-live="polite"></span>
              </div>

              <div class="input-group">
                <label for="signup-email">ایمیل</label>
                <input id="signup-email" type="email" name="email" placeholder="you@example.com" required/>
                <span class="field-error" aria-live="polite"></span>
              </div>

              <div class="input-group">
                <label for="signup-phone">شماره موبایل (اختیاری)</label>
                <input id="signup-phone" type="tel" name="phone" placeholder="09xxxxxxxxx" pattern="^09\\d{9}$"/>
                <span class="field-error" aria-live="polite"></span>
              </div>

              <div class="input-group password-group">
                <label for="signup-password">رمز عبور</label>
                <input id="signup-password" type="password" name="password" placeholder="حداقل ۸ کاراکتر" minlength="8" required/>
                <button type="button" class="toggle-password" aria-label="نمایش/مخفی کردن رمز">👁</button>

                <div class="password-strength" aria-hidden="true">
                  <div class="bar"></div>
                </div>
                <small class="hint">حداقل ۸ کاراکتر شامل حرف و عدد</small>
                <span class="field-error" aria-live="polite"></span>
              </div>

              <div class="input-group">
                <label for="signup-confirm">تکرار رمز عبور</label>
                <input id="signup-confirm" type="password" name="confirm" placeholder="تکرار رمز" required/>
                <span class="field-error" aria-live="polite"></span>
              </div>

              <label class="checkbox">
                <input type="checkbox" name="terms" required/>
                شرایط و قوانین را می‌پذیرم
              </label>

              <button type="submit" class="btn primary">ثبت نام</button>

              <div class="form-message" aria-live="polite"></div>
            </form>
          </div>
        </div>

        <p class="auth-note">با ورود یا ثبت‌نام، شما با شرایط و قوانین OMID موافقت می‌کنید.</p>
      </div>
    </main>
  </div>

  <!-- مودال بازیابی رمز -->
  <div id="reset-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="reset-title">
    <div class="modal-content">
      <h3 id="reset-title">بازیابی رمز عبور</h3>
      <p>ایمیل خود را وارد کنید تا لینک بازیابی برای شما ارسال شود.</p>
      <form id="reset-form" novalidate>
        <input type="email" name="email" placeholder="you@example.com" required />
        <div class="modal-actions">
          <button type="button" class="btn outline" id="close-reset">انصراف</button>
          <button type="submit" class="btn primary">ارسال لینک</button>
        </div>
      </form>
    </div>
  </div>

  <!-- اسکریپت‌ها -->
  <script>
    // تم ذخیره‌شده
    const applyTheme = (t) => {
      document.documentElement.setAttribute('data-theme', t);
      localStorage.setItem('theme', t);
    };
    applyTheme(localStorage.getItem('theme') || 'light');

    // سوئیچ تم
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle?.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      applyTheme(current === 'light' ? 'dark' : 'light');
    });

    // سوئیچ تب‌ها
    const tabs = document.querySelectorAll('.auth-tab');
    const forms = document.querySelectorAll('.auth-form');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const target = document.querySelector(tab.dataset.target);
        forms.forEach(f => f.classList.remove('active'));
        target?.classList.add('active');
      });
    });

    // نمایش/مخفی کردن رمز
    document.querySelectorAll('.toggle-password').forEach(btn => {
      btn.addEventListener('click', () => {
        const input = btn.previousElementSibling;
        if (!input) return;
        input.type = input.type === 'password' ? 'text' : 'password';
        btn.textContent = input.type === 'password' ? '👁' : '👁‍🗨';
      });
    });

    // قدرت رمز (ثبت‌نام)
    const pwd = document.getElementById('signup-password');
    const bar = document.querySelector('.password-strength .bar');
    const strength = (val) => {
      let s = 0;
      if (val.length >= 8) s++;
      if (/[A-Za-z]/.test(val)) s++;
      if (/[0-9]/.test(val)) s++;
      if (/[^A-Za-z0-9]/.test(val)) s++;
      return s; // 0..4
    };
    pwd?.addEventListener('input', (e) => {
      const val = e.target.value;
      const score = strength(val);
      const width = (score / 4) * 100;
      bar.style.width = width + '%';
      bar.dataset.score = String(score);
    });

    // اعتبارسنجی پایه
    const setError = (input, message) => {
      const err = input.parentElement.querySelector('.field-error');
      if (err) err.textContent = message || '';
      input.classList.toggle('invalid', !!message);
    };

    const emailValid = (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

    document.getElementById('login')?.addEventListener('submit', (e) => {
      e.preventDefault();
      const form = e.target;
      const email = form.email;
      const password = form.password;
      let ok = true;

      if (!emailValid(email.value)) {
        setError(email, 'ایمیل معتبر نیست');
        ok = false;
      } else setError(email, '');

      if (!password.value) {
        setError(password, 'رمز عبور الزامی است');
        ok = false;
      } else setError(password, '');

      const msg = form.querySelector('.form-message');
      if (ok) {
        msg.textContent = 'ورود با موفقیت انجام شد. در حال انتقال...';
        msg.classList.add('success');
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 900);
      } else {
        msg.textContent = 'لطفا خطاهای فرم را برطرف کنید.';
        msg.classList.remove('success');
      }
    });

    document.getElementById('signup')?.addEventListener('submit', (e) => {
      e.preventDefault();
      const form = e.target;
      const name = form.name;
      const email = form.email;
      const phone = form.phone;
      const password = form.password;
      const confirm = form.confirm;
      const terms = form.terms;
      let ok = true;

      if (!name.value.trim()) { setError(name, 'نام را وارد کنید'); ok = false; } else setError(name, '');
      if (!emailValid(email.value)) { setError(email, 'ایمیل معتبر نیست'); ok = false; } else setError(email, '');
      if (phone.value && !/^09\d{9}$/.test(phone.value)) { setError(phone, 'شماره موبایل معتبر نیست'); ok = false; } else setError(phone, '');
      if (password.value.length < 8 || !(/[A-Za-z]/.test(password.value) && /[0-9]/.test(password.value))) {
        setError(password, 'رمز باید حداقل ۸ کاراکتر و شامل حرف و عدد باشد');
        ok = false;
      } else setError(password, '');
      if (confirm.value !== password.value) { setError(confirm, 'تکرار رمز مطابقت ندارد'); ok = false; } else setError(confirm, '');
      if (!terms.checked) ok = false;

      const msg = form.querySelector('.form-message');
      if (ok) {
        msg.textContent = 'ثبت‌نام انجام شد! اکنون می‌توانید وارد شوید.';
        msg.classList.add('success');
        // سوییچ خودکار به تب ورود
        document.querySelector('.auth-tab[data-target="#login"]').click();
      } else {
        msg.textContent = 'لطفا خطاهای فرم را برطرف کنید.';
        msg.classList.remove('success');
      }
    });

    // مودال فراموشی رمز
    const modal = document.getElementById('reset-modal');
    const forgot = document.getElementById('forgot-link');
    const closeReset = document.getElementById('close-reset');
    forgot?.addEventListener('click', (e) => {
      e.preventDefault();
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
    });
    closeReset?.addEventListener('click', () => {
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
    });
    document.getElementById('reset-form')?.addEventListener('submit', (e) => {
      e.preventDefault();
      modal.classList.remove('open');
      alert('اگر ایمیل شما ثبت شده باشد، لینک بازیابی ارسال می‌شود.');
    });
  </script>
</body>
</html>